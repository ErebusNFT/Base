<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Base NFT Terminal • Live NFTs on Base</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Base NFT Terminal – paste a Base wallet and see its NFTs using live data."
  />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --base-blue: #0052ff;
      --bg: radial-gradient(circle at top, #020617 0, #020617 55%, #020617 100%);
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter",
        sans-serif;
    }

    .glass {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(18px);
      box-shadow:
        0 22px 48px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .primary-btn {
      background: linear-gradient(to right, var(--base-blue), #1d9bf0);
      color: white;
      transition: all 0.18s ease;
    }
    .primary-btn:hover {
      filter: brightness(1.08);
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(37, 99, 235, 0.7);
    }

    .pill {
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      font-size: 0.75rem;
      padding: 0.25rem 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .gradient-text {
      background: linear-gradient(to right, #60a5fa, #dbeafe);
      -webkit-background-clip: text;
      color: transparent;
    }

    .blur-orb {
      position: fixed;
      border-radius: 9999px;
      filter: blur(90px);
      opacity: 0.9;
      pointer-events: none;
      z-index: -10;
    }
    .blur-orb.orb-1 {
      width: 360px;
      height: 360px;
      background: rgba(37, 99, 235, 0.7);
      top: -90px;
      right: -60px;
    }
    .blur-orb.orb-2 {
      width: 260px;
      height: 260px;
      background: rgba(59, 130, 246, 0.7);
      bottom: -80px;
      left: -40px;
    }

    .nft-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 22px 38px rgba(15, 23, 42, 0.95);
    }

    ::-webkit-scrollbar { width: 9px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb {
      background: rgba(51, 65, 85, 0.95);
      border-radius: 9999px;
    }
  </style>
</head>

<body class="text-slate-100">
  <!-- background glow -->
  <div class="blur-orb orb-1"></div>
  <div class="blur-orb orb-2"></div>

  <!-- HEADER -->
  <header class="max-w-6xl mx-auto px-5 pt-5 pb-4 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <div class="w-11 h-11 rounded-2xl flex items-center justify-center bg-slate-950 border border-slate-700">
        <span class="text-xl font-semibold tracking-tight text-blue-400">BΞ</span>
      </div>
      <div>
        <p class="text-xs uppercase tracking-[0.22em] text-slate-400">
          Base NFT Terminal
        </p>
        <p class="text-sm md:text-base text-slate-300">
          Live NFTs on <span class="font-semibold text-blue-400">Base</span> (chain 8453)
        </p>
      </div>
    </div>

    <div class="flex flex-col items-end gap-1 text-sm">
      <a
        href="https://x.com/Blu3_NFT"
        target="_blank"
        class="pill text-slate-200 hover:text-blue-300 hover:border-blue-400 transition-colors"
      >
        Built by @Blu3_NFT
      </a>
      <span class="text-[0.8rem] text-slate-500">
        Read-only • Data proxied via /api/nfts
      </span>
    </div>
  </header>

  <!-- HERO -->
  <section class="max-w-6xl mx-auto px-5 pb-6">
    <div class="glass rounded-3xl p-6 md:p-7 flex flex-col gap-6">
      <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
        <div class="space-y-3 max-w-xl">
          <span class="pill text-slate-200">NFTs on Base only</span>
          <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight">
            Paste a wallet.
            <span class="gradient-text">See its Base NFTs.</span>
          </h1>
          <p class="text-base md:text-lg text-slate-300">
            No fake data. If the wallet has NFTs on Base, they appear. If not, you see zero.
          </p>
        </div>

        <div class="w-full max-w-md">
          <div class="rounded-2xl border border-slate-700 bg-slate-950/95 p-4 space-y-3">
            <label
              for="addressInput"
              class="block text-sm md:text-base font-medium text-slate-200 mb-1"
            >
              Base wallet address (0x…)
            </label>
            <div class="flex gap-2">
              <input
                id="addressInput"
                type="text"
                placeholder="0x..."
                spellcheck="false"
                class="flex-1 rounded-xl border border-slate-600 bg-slate-950 px-3 py-2.5 text-base text-slate-100 placeholder-slate-500 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
              />
              <button
                id="pasteButton"
                class="rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sm text-slate-200 hover:bg-slate-800"
              >
                Paste
              </button>
            </div>
            <button
              id="analyzeButton"
              class="primary-btn w-full rounded-xl px-4 py-2.7 text-base font-semibold flex items-center justify-center gap-2"
            >
              <span class="w-2 h-2 rounded-full bg-emerald-300 animate-pulse"></span>
              View NFTs on Base
            </button>
            <p id="errorText" class="text-sm text-red-400 hidden"></p>
            <p id="statusText" class="text-[0.8rem] text-slate-500">
              Waiting for address…
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main class="max-w-6xl mx-auto px-5 pb-16 space-y-5">
    <!-- STATS -->
    <section class="glass rounded-3xl p-5 md:p-6 flex flex-col md:flex-row items-center md:items-stretch gap-4">
      <div class="flex-1 flex flex-col gap-3">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Snapshot</p>
        <p id="currentAddress" class="text-base md:text-lg text-slate-300">
          No address loaded.
        </p>
      </div>
      <div class="grid grid-cols-3 gap-3 w-full md:w-auto">
        <div class="rounded-2xl border border-slate-700 bg-slate-950/95 px-4 py-3">
          <p class="text-[0.8rem] text-slate-400">NFTs on Base</p>
          <p id="statNfts" class="text-2xl md:text-3xl font-semibold text-blue-300">0</p>
        </div>
        <div class="rounded-2xl border border-slate-700 bg-slate-950/95 px-4 py-3">
          <p class="text-[0.8rem] text-slate-400">Collections</p>
          <p id="statCollections" class="text-2xl md:text-3xl font-semibold text-emerald-300">0</p>
        </div>
        <div class="rounded-2xl border border-slate-700 bg-slate-950/95 px-4 py-3">
          <p class="text-[0.8rem] text-slate-400">Last fetch</p>
          <p id="statUpdated" class="text-sm md:text-base font-semibold text-slate-100">—</p>
        </div>
      </div>
    </section>

    <!-- NFT GRID -->
    <section class="glass rounded-3xl p-5 md:p-6">
      <div class="flex items-center justify-between mb-4">
        <p class="text-base md:text-lg text-slate-200">
          NFTs for this wallet on <span class="text-blue-400 font-semibold">Base</span>
        </p>
        <p class="text-xs text-slate-500">
          Data proxied via <code>/api/nfts</code>
        </p>
      </div>

      <div id="nftGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="rounded-2xl border border-dashed border-slate-700 bg-slate-950/85 px-4 py-4 text-sm text-slate-400">
          Paste a Base address and click
          <span class="font-semibold text-slate-200">“View NFTs on Base”</span>.
        </div>
      </div>
    </section>
  </main>

  <!-- SCRIPT -->
  <script>
    const addressInput = document.getElementById("addressInput");
    const pasteButton = document.getElementById("pasteButton");
    const analyzeButton = document.getElementById("analyzeButton");
    const errorText = document.getElementById("errorText");
    const statusText = document.getElementById("statusText");

    const currentAddressEl = document.getElementById("currentAddress");
    const statNftsEl = document.getElementById("statNfts");
    const statCollectionsEl = document.getElementById("statCollections");
    const statUpdatedEl = document.getElementById("statUpdated");
    const nftGrid = document.getElementById("nftGrid");

    function isValidEvmAddress(addr) {
      if (!addr) return false;
      return /^0x[a-fA-F0-9]{40}$/.test(addr.trim());
    }

    function shortenAddress(addr) {
      if (!addr || addr.length < 10) return addr;
      return addr.slice(0, 6) + "…" + addr.slice(-4);
    }

    function showError(msg) {
      errorText.textContent = msg;
      errorText.classList.remove("hidden");
    }

    function clearError() {
      errorText.classList.add("hidden");
    }

    function setStatus(msg) {
      statusText.textContent = msg;
    }

    function clearGrid() {
      nftGrid.innerHTML = "";
    }

    function renderEmpty(message) {
      clearGrid();
      const div = document.createElement("div");
      div.className =
        "rounded-2xl border border-dashed border-slate-700 bg-slate-950/85 px-4 py-4 text-sm text-slate-400";
      div.textContent = message;
      nftGrid.appendChild(div);
    }

    async function fetchBaseNfts(address) {
      const res = await fetch(`/api/nfts?address=${encodeURIComponent(address)}`);
      if (!res.ok) {
        throw new Error("API error " + res.status);
      }
      const json = await res.json();
      if (json.error) {
        throw new Error(json.error);
      }
      if (!json.data || !Array.isArray(json.data.items)) {
        throw new Error("Unexpected API response.");
      }

      const items = json.data.items;
      const nfts = [];

      items.forEach((item) => {
        const nftData = item.nft_data;
        if (!nftData || !nftData.length) return;

        nftData.forEach((n) => {
          const ext = n.external_data || {};
          const image =
            ext.image || n.image || "https://via.placeholder.com/400x400?text=NFT";
          const name =
            ext.name ||
            item.contract_name ||
            item.contract_ticker_symbol ||
            "Base NFT";
          const tokenId = n.token_id || n.token_id_str || "—";
          const tokenUrl = n.token_url || ext.external_url || null;

          nfts.push({
            contract: item.contract_address,
            collectionName: item.contract_name || "Unknown collection",
            symbol: item.contract_ticker_symbol || "",
            image,
            name,
            tokenId,
            tokenUrl,
          });
        });
      });

      return nfts;
    }

    function renderNfts(address, nfts) {
      clearGrid();

      currentAddressEl.textContent =
        "Address: " + (address ? shortenAddress(address) : "—");
      statNftsEl.textContent = nfts.length.toString();

      const uniqueCollections = new Set(
        nfts.map((n) => n.collectionName + "|" + n.contract)
      );
      statCollectionsEl.textContent = uniqueCollections.size.toString();

      const now = new Date();
      statUpdatedEl.textContent = now.toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit",
      });

      if (!nfts.length) {
        renderEmpty(
          "This wallet has no NFTs indexed on Base from this API. Try another Base address."
        );
        return;
      }

      nfts.slice(0, 60).forEach((nft) => {
        const card = document.createElement("div");
        card.className =
          "nft-card rounded-2xl border border-slate-700 bg-slate-950/95 overflow-hidden transition-transform duration-150 flex flex-col";

        card.innerHTML = `
          <div class="relative">
            <img src="${nft.image}" alt="${nft.name}" class="w-full h-48 object-cover" />
            <div class="absolute left-3 top-3 flex items-center gap-2">
              <span class="pill text-[0.6rem] bg-slate-950/80 border-slate-600">Base</span>
            </div>
          </div>
          <div class="p-3.5 flex-1 flex flex-col gap-1.5">
            <p class="text-sm md:text-base font-semibold text-slate-50 truncate">${nft.name}</p>
            <p class="text-xs text-slate-400 truncate">${nft.collectionName}</p>
            <p class="text-xs text-slate-500">
              Token ID: <span class="font-mono text-slate-200">${nft.tokenId}</span>
            </p>
            <p class="text-[0.7rem] text-slate-500 mt-auto">
              Contract: <span class="font-mono">${shortenAddress(nft.contract)}</span>
            </p>
            ${
              nft.tokenUrl
                ? `<a href="${nft.tokenUrl}" target="_blank" class="mt-1 inline-block text-xs text-blue-300 hover:text-blue-200">View metadata</a>`
                : ""
            }
          </div>
        `;

        nftGrid.appendChild(card);
      });
    }

    async function handleAnalyze() {
      clearError();
      setStatus("Checking address…");

      const addr = addressInput.value.trim();
      if (!isValidEvmAddress(addr)) {
        showError("Please paste a valid 0x… EVM address on Base.");
        setStatus("Invalid address.");
        return;
      }

      analyzeButton.disabled = true;
      analyzeButton.classList.add("opacity-70");
      analyzeButton.textContent = "Loading…";

      try {
        setStatus("Loading live NFTs from /api/nfts…");
        const nfts = await fetchBaseNfts(addr);
        renderNfts(addr, nfts);
        setStatus(
          nfts.length
            ? "Loaded live NFT data from Base."
            : "No NFTs found on Base for this address."
        );
      } catch (err) {
        console.error(err);
        showError(err.message || "Failed to load NFT data.");
        renderEmpty("Could not load NFTs. Check API logs or try again.");
        setStatus("Error while calling the API.");
      } finally {
        analyzeButton.disabled = false;
        analyzeButton.classList.remove("opacity-70");
        analyzeButton.textContent = "View NFTs on Base";
      }
    }

    analyzeButton.addEventListener("click", handleAnalyze);

    addressInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleAnalyze();
      }
    });

    pasteButton.addEventListener("click", async () => {
      if (!navigator.clipboard) return;
      try {
        const text = await navigator.clipboard.readText();
        if (text) {
          addressInput.value = text.trim();
          clearError();
          setStatus("Address pasted. Click “View NFTs on Base”.");
        }
      } catch (e) {
        console.warn("Clipboard read failed", e);
      }
    });
  </script>
</body>
</html>
